openapi: 3.0.0

info:
  title: Dream-tracker Habit Tracking App
  version: '1.0'
  description: API for a habit tracking application
  contact:
    name: API Support Team
    url: https://www.dream-tracker.com/support
    email: playfulCloud@proton.me
  x-api-id: urn:dream-tracker:habit-tracking-app:1.0
  x-audience: Public
servers:
  - url: https://localhost:8080/api

tags:
  - name: habit
  - name: view
  - name: goal
  - name: category

paths:
  /habits:
    post:
      tags:
        - habit
      summary: Create a new Habit
      description: Creates a new habit based on the provided habit details.
      requestBody:
        description: Accepts a single habit object.
        required: true
        content:
          application/json:
            schema:
              type: object
              items:
                $ref: '#/components/schemas/HabitRequest'
      responses:
        201:
          description: Habit correctly created
          content:
            application/json:
              schema:
                type: object
                items:
                  $ref: '#/components/schemas/HabitResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      tags:
        - habit
      summary: Retrieve All Habits
      description: Fetches a list of all habits stored in the database.
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                type: object
                items:
                  $ref: '#/components/schemas/HabitResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.

  /habits/{habit-id}/category/{category-id}:
    put:
      tags:
        - habit
      summary: Associate a category with a habit
      description: Associates a specific category with an existing habit using their respective identifiers.
      parameters:
        - in: path
          name: habit-id
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier of the habit.
        - in: path
          name: category-id
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier of the category to associate.
      responses:
        200:
          description: Category associated with habit successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /habits/{habit-id}:
    put:
      tags:
        - habit
      summary: Update a Specific Habit
      description: Updates the details of an existing habit identified by its unique ID.
      parameters:
        - in: path
          name: habit-id
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier of the habit.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitRequest'
      responses:
        200:
          description: Habit has been successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    delete:
      tags:
        - habit
      summary: Delete a Specific Habit
      description: Removes a habit from the system using its unique identifier.
      parameters:
        - in: path
          name: habit_id
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier of the habit.
      responses:
        204:
          description: Habit properly deleted
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      tags:
        - habit
      summary: Retrieve a Specific Habit
      description: Fetches the details of a habit using its unique identifier.
      parameters:
        - in: path
          name: habit_id
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier of the habit.
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /habits/user:
    get:
      tags:
        - habit
      summary: Retrieve Habits for a User
      description: Fetches all habits associated with a specific user. This endpoint requires JWT send through header which include the user id needed for further computation.
      security:
        - bearerAuth: []
      responses:
        200:
          description: List of habits successfully retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /habits/stats:
    put:
      tags:
        - habit
      summary: Mark habit as done or undone for according time interval
      description: Creates record in HabitStats database with according habit and status passed through habitStatsRequest
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitStatsRequest'
      responses:
        200:
          description: Success
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /habits/charts/{habit-id}:
    get:
      tags:
        - habit
      summary: Fetches charts aggregated based on specific habit.
      parameters:
        - in: path
          name: habit_id
          required: true
          schema:
            type: string
            format: uuid
          description: The unique identifier of the habit.
      responses:
        200:
          description: Habit charts successfully retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HabitChartsResponse'
        404:
          description: The server has not found anything matching the Request-URI or the resource is not available.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'


  /goals:
    post:
      tags:
        - goal
      summary: Create goal
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Goal'
      responses:
        201:
          description: goal correctly created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Goal'
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      tags:
        - goal
      summary: Get all the goals
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Goal'
        500:
          description: Internal server error
  /goals/user/{user_id}:
    get:
      tags:
        - goal
      summary: Get all the goals of specified user by id
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the user.
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Goal'
        500:
          description: Internal server error
  /goals/{goal_id}:
    put:
      tags:
        - goal
      summary: Updates existing goal by id
      parameters:
        - in: path
          name: goal_id
          required: true
          schema:
            type: integer
          description: The unique identifier of a goal to be updated.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Goal'
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Goal'
        400:
          description: Bad Request - The request was invalid or cannot be served.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      tags:
        - goal
      summary: Delete goal by id
      parameters:
        - in: path
          name: goal_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the goal.
      responses:
        204:
          description: Goal properly deleted
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    get:
      tags:
        - goal
      summary: Get a specified goal by id
      parameters:
        - in: path
          name: goal_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the goal.
      responses:
        200:
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Goal'
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /goals/{goal_id}/habits:
    post:
      tags:
        - goal
      summary: Add a habit to a goal
      description: Associates an existing habit with a specified goal by adding the habit's ID to the goal's habit list.
      parameters:
        - in: path
          name: goal_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the goal to which the habit will be added.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Goal'
      responses:
        200:
          description: Habit added to the goal successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Goal'
        400:
          description: Invalid input, object invalid
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Goal not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /categories:
    post:
      tags:
        - category
      summary: Create a new category
      description: Adds a new category to the system.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  description: The name of the category to be created.
      responses:
        201:
          description: Category created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - category
      summary: Get all categories
      description: Retrieves a list of all categories.
      responses:
        200:
          description: An array of categories.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        500:
          description: Internal server error

  /categories/{category_id}:
    get:
      tags:
        - category
      summary: Get a specific category
      parameters:
        - in: path
          name: category_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the category
      description: Retrieves a category by its ID.
      responses:
        200:
          description: Details of a specific category.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        404:
          description: Category not found

    put:
      tags:
        - category
      summary: Update a specific category
      description: Updates the details of an existing category.
      parameters:
        - in: path
          name: category_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the category
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Category'
      responses:
        200:
          description: Category updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: Category not found

    delete:
      tags:
        - category
      summary: Delete a specific category
      description: Removes a category from the system.
      parameters:
        - in: path
          name: category_id
          required: true
          schema:
            type: integer
          description: The unique identifier of the category
      responses:
        204:
          description: Category deleted successfully.
        404:
          description: Category not found


  /views:
    post:
      tags:
        - view
      summary: Create a new view
      description: Adds a new custom view configuration to the user's profile.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/View'
      responses:
        201:
          description: View created successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/View'
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

    get:
      tags:
        - view
      summary: Get all views
      description: Retrieves a list of all views configured by the user.
      responses:
        200:
          description: An array of views.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/View'
        500:
          description: Internal server error

  /views/{view_id}:
    parameters:
      - in: path
        name: view_id
        required: true
        schema:
          type: integer
        description: The unique identifier of the view

    get:
      tags:
        - view
      summary: Get a specific view
      description: Retrieves a specific view by its ID.
      responses:
        200:
          description: Details of a specific view.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/View'
        404:
          description: View not found

    put:
      tags:
        - view
      summary: Update a specific view
      description: Updates the configuration of an existing view.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/View'
      responses:
        200:
          description: View updated successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/View'
        400:
          description: Bad Request - The request was invalid or cannot be served
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        404:
          description: View not found

    delete:
      tags:
        - view
      summary: Delete a specific view
      description: Removes a view from the system.
      responses:
        204:
          description: View deleted successfully.
        404:
          description: View not found
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Habit:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the habit.'
          example: 1
        name:
          type: string
          example: 'Morning Run'
        action:
          type: string
          example: 'Running 5km'
        frequency:
          type: string
          enum: [ Daily, Weekly, Monthly ]
          example: 'Daily'
        duration:
          type: integer
          format: int64
          description: 'Amount of activity in specified by frequency time interval'
          example: 30
        difficulty:
          type: string
          enum: [ Easy, Medium, Hard ]
          example: 'Medium'
        status:
          type: string
          enum: [ Active, Inactive ]
          example: 'Active'
        habit_stats:
          type: array
          items:
            $ref: '#/components/schemas/HabitStats'
        habit_charts:
          $ref: '#/components/schemas/HabitCharts'
        category:
          type: array
          items:
            $ref: '#/components/schemas/Category'
        view:
          type: array
          items:
            $ref: '#/components/schemas/View'
    HabitStats:
      type: object
      description: "This schema contains data about habit implementation status in described by date moment in time"
      required:
        - id
        - date
        - status
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the habit statistic.'
          nullable: false
        date:
          type: string
          format: date
          description: 'Date of setting habit status as done or undone in ISO 8601 format'
          nullable: false
        status:
          type: string
          enum:
            - done
            - undone
    HabitCharts:
      type: object
      description: 'This schema aggregates data from Habit and HabitStats'
      required:
        - id
        - not_completion_counts
        - completionCounts
        - frequency_adherence
        - difficulty_to_frequency_correlation
        - improvement_trend
      properties:
        id:
          type: string
          format: uuid
          nullable: false
          description: 'The unique identifier of the habit chart.'
        not_completion_counts:
          type: integer
          format: int64
          default: 0
        completionCounts:
          type: integer
          default: 0
        frequency_adherence:
          type: number
          format: float
          description: 'Percentage of adherence to the planned frequency of the habit.'
        difficulty_to_frequency_correlation:
          type: number
          format: float
          description: 'Success rate related to the difficulty level of the habit.'
        improvement_trend:
          type: string
          enum:
            - improvement
            - deterioration
            - stagnation
    HabitRequest:
      type: object
      required:
        - name
        - action
        - frequency
        - duration
        - difficulty
      properties:
        name:
          type: string
          example: 'Morning Run'
        action:
          type: string
          example: 'Running 5km'
        frequency:
          type: string
          enum: [ Daily, Weekly, Monthly ]
          example: 'Daily'
        duration:
          type: integer
          format: int64
          description: 'Amount of activity in specified by frequency time interval'
          example: 30
        difficulty:
          type: string
          enum: [ Easy, Medium, Hard ]
          example: 'Medium'
    HabitStatsRequest:
      type: object
      required:
        - habitId
        - status
      properties:
        habitId:
          type: string
          format: uuid
        status:
          type: string
          enum: [Done, Undone]
    HabitCategoryAdditionRequest:
      type: object
      required:
        - categoryId
      properties:
        categoryId:
          type: string
          format: uuid
          description: 'The unique identifier of the category'
    HabitResponse:
      type: array
      items:
        $ref: '#/components/schemas/Habit'
    HabitChartsResponse:
      type: array
      items:
        $ref: '#/components/schemas/HabitCharts'
    Goal:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the goal.'
        name:
          type: string
          example: 'Health Improvement'
        duration:
          type: integer
          format: int64
          description: 'Duration of the goal in days'
          example: 60
        goal_habit_summary:
          type: array
          items:
            $ref: '#/components/schemas/GoalHabitSummary'
        goal_charts:
          $ref: '#/components/schemas/GoalCharts'
        view:
          type: array
          items:
            $ref: '#/components/schemas/View'
    GoalHabitSummary:
      type: object
      description: 'This schema keeps track of habits completion from the time when habit is associated with a certain goal'
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the goal habit summary.'
        amount_to_complete:
          type: integer
          format: int64
          description: 'Number of habit_stats records marked as done to finish this part of goal'
        actual_amount:
          type: integer
          format: int64
          description: 'Number of habit_stats records marked as done from time when habit is associated with goal'
        habit:
          $ref: '#/components/schemas/Habit'
    GoalCharts:
      type: object
      description: 'This schema aggregates data from habits attached to goal and offers statistics about goal progression'
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the goal chart.'
        percent_of_completion:
          type: number
          format: float
    GoalRequest:
      type: object
      required:
        - name
        - duration
      properties:
        name:
          type: string
          example: 'Health Improvement'
        duration:
          type: integer
          format: int64
          description: 'Duration of the goal in days'
          example: 60
    GoalHabitSummaryAdditionRequest:
     type: object
     required:
       - habitId
       - amount_to_complete
     properties:
       habitId:
         type: string
         format: uuid
         description: 'The unique identifier of the habit'
       amount_to_complete:
         type: integer
         format: int64
         description: 'Integer value of habit records marked as done to complete this part of the goal'
    GoalResponse:
      type: array
      items:
        $ref: '#/components/schemas/Goal'
    View:
      type: object
      description: 'Schema which contains set of information needed to display interface'
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the view.'
        type:
          type: string
          enum: [ Habit, Goal, Category ]
          description: 'The focus of the view (habit, goal, or category).'
          example: 'Habit'
        layout:
          type: string
          enum: [ List, Grid, Custom ]
          description: 'The layout format of the view.'
          example: 'Grid'
        categories:
          type: array
          items:
            $ref: '#/components/schemas/Category'
        goals:
          type: array
          items:
            $ref: '#/components/schemas/Goal'
        habits:
          type: array
          items:
            $ref: '#/components/schemas/Habit'
    ViewRequest:
      type: object
      required:
        - type
        - layout
      properties:
        type:
          type: string
          enum: [ Habit, Goal, Category ]
          description: 'The focus of the view (habit, goal, or category).'
          example: 'Habit'
        layout:
          type: string
          enum: [ List, Grid, Custom ]
          description: 'The layout format of the view.'
          example: 'Grid'
    ViewHabitModificationRequest:
      type: object
      description: 'Request schema responsible for attaching and detaching habit with the view'
      required:
        - habitId
        - viewId
      properties:
        habitId:
          type: string
          format: uuid
        viewId:
          type: string
          format: uuid
    ViewGoalModificationRequest:
      type: object
      description: 'Request schema responsible for attaching and detaching goal with the view'
      required:
        - goalId
        - viewId
      properties:
        goalId:
          type: string
          format: uuid
        viewId:
          type: string
          format: uuid
    ViewCategoryModificationRequest:
      type: object
      description: 'Request schema responsible for attaching and detaching category with the view'
      required:
        - categoryId
        - viewId
      properties:
        categoryId:
          type: string
          format: uuid
        viewId:
          type: string
          format: uuid
    ViewResponse:
      type: array
      items:
        $ref: '#/components/schemas/View'
    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
          description: 'The unique identifier of the category.'
        name:
          type: string
          description: 'The name of the category'
          example: 'Fitness'
        view:
          type: array
          items:
            $ref: '#/components/schemas/View'
    CategoryRequest:
      type: object
      required:
        name:
          type: string
      properties:
        name:
          type: string
          description: 'The name of the category'
          example: 'Fitness'
    CategoryResponse:
      type: array
      items:
        $ref: '#/components/schemas/Category'
    Error:
      type: object
      required: [ code, message ]
      properties:
        code:
          type: integer
          format: int64
          description: "Error code representing the type of error"
        message:
          type: string
          description: "Human-readable message describing the error"
        details:
          type: string
          description: "Additional details that might help diagnose the issue"

